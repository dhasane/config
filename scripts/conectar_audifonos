#!/bin/sh

MAC="00:18:09:A2:DC:0D"
AUDIFONOS="41:42:99:D1:89:21"
# MAC="E1:AB:C5:A8:F3:A1"
connect()
{
    rep=0
	ret="inicio"
	while [ -n "$ret" ]
	do
        rep=$((rep+1))
        ret=$(bluetoothctl connect "$MAC" | grep Fail)
	done
    echo "connected after $rep attempts"
}

if [ -z "$1" ]
then
    printf "\t options\n"
    printf "\t [c]onnect \n"
    printf "\t [a]udifonos \n"
    printf "\t [r]e connect \n"
    printf "\t [d]isconnect \n"
    printf "\t change [m]ac \n"

else
    while getopts m:crda option
    do
        if [ "$option" = "m" ];then
            MAC=$OPTARG
            echo "conectando a $MAC"
        fi
        if [ "$option" = "a" ];then
            MAC=$AUDIFONOS
            echo "conectando a $MAC"
        fi
        if [ "$option" = "d" ] || [ "$option" = "r" ]; then
            sudo rfkill block bluetooth
            bluetoothctl discoverable off
        fi
        if [ "$option" = "r" ] || [ "$option" = "c" ] || [ "$option" = "m" ]; then
            bluetoothctl discoverable on
            sudo rfkill unblock bluetooth
            connect
            bluetoothctl discoverable off
        fi
    done
fi
